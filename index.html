<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="origin">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>ì œíœ´ì—…ì²´ ì°¾ê¸° - íŒŒíŠ¸ë„ˆ ì§€ë„</title>
  
  <!-- ë„¤ì´ë²„ ì§€ë„ API: ë°œê¸‰ë°›ì€ Client IDë¡œ êµì²´í•˜ì„¸ìš” -->
  <script>
    // ë„¤ì´ë²„ ì§€ë„ API ë™ì  ë¡œë“œ
    (function() {
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=bfp8odep5r&t=' + Date.now();
      script.async = true;
      script.onerror = function() {
        console.error('âŒ ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
        window.naverMapLoadError = true;
      };
      script.onload = function() {
        console.log('âœ… ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
        window.naverMapLoaded = true;
        // ì§€ë„ ì´ˆê¸°í™”ê°€ ëŒ€ê¸° ì¤‘ì´ë©´ ì‹¤í–‰
        if (window.pendingMapInit) {
          window.pendingMapInit();
        }
      };
      document.head.appendChild(script);
    })();
  </script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Segoe UI', sans-serif; 
      font-size: 16px; 
      line-height: 1.7; 
      color: #2C2C2C; 
      background-color: #F9F8F5; 
    }
    
    /* í—¤ë” */
    .page-header { 
      background: linear-gradient(135deg, #7B8E7E 0%, #5A6B5D 100%); 
      color: white; 
      padding: 48px 20px; 
      text-align: center; 
    }
    
    .page-title { 
      font-size: 28px; 
      font-weight: bold; 
      margin-bottom: 12px; 
    }
    
    .page-subtitle { 
      font-size: 16px; 
      opacity: 0.95; 
    }
    
    /* ìƒíƒœ ì•Œë¦¼ */
    .status-notice { 
      border-radius: 12px; 
      padding: 20px; 
      margin: 20px auto; 
      max-width: 1280px; 
      text-align: center; 
      display: none;
    }
    
    .status-notice h3 { 
      margin-bottom: 10px; 
      font-size: 18px; 
    }
    
    .status-notice p { 
      font-size: 14px; 
      line-height: 1.6; 
    }
    
    .status-loading { 
      background-color: #E3F2FD; 
      border: 2px solid #2196F3; 
      display: block;
    }
    
    .status-loading h3 { 
      color: #1976D2; 
    }
    
    .status-error { 
      background-color: #FFEBEE; 
      border: 2px solid #F44336; 
    }
    
    .status-error h3 { 
      color: #D32F2D; 
    }
    
    .status-error .error-details { 
      margin-top: 12px; 
      padding: 12px; 
      background-color: #FFCDD2; 
      border-radius: 6px; 
      font-family: monospace; 
      font-size: 12px; 
      text-align: left; 
    }
    
    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .main-container {
      display: flex;
      max-width: 1440px;
      margin: 0 auto;
      padding: 20px;
      gap: 20px;
    }
    
    /* ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 320px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      height: fit-content;
      position: sticky;
      top: 20px;
    }
    
    .sidebar-title {
      font-size: 18px;
      font-weight: 700;
      color: #2C2C2C;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* ê²€ìƒ‰ì°½ */
    .search-box {
      margin-bottom: 20px;
    }
    
    .search-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #E0E0E0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #7B8E7E;
      box-shadow: 0 0 0 3px rgba(123, 142, 126, 0.1);
    }
    
    .search-input::placeholder {
      color: #999;
    }
    
    /* ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ */
    .quick-actions {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .quick-btn {
      flex: 1;
      padding: 10px;
      background: white;
      border: 2px solid #E0E0E0;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .quick-btn:hover {
      border-color: #7B8E7E;
      background: #F5F5F5;
    }
    
    .quick-btn.active {
      background: #7B8E7E;
      color: white;
      border-color: #7B8E7E;
    }
    
    .filter-section {
      margin-bottom: 24px;
    }
    
    .filter-section:last-child {
      margin-bottom: 0;
    }
    
    .filter-label {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .filter-btn {
      padding: 8px 16px;
      border: 2px solid #E0E0E0;
      background: white;
      color: #666;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    .filter-btn:hover {
      border-color: #7B8E7E;
      color: #7B8E7E;
      background: #F5F5F5;
    }
    
    .filter-btn.active {
      background: #7B8E7E;
      color: white;
      border-color: #7B8E7E;
    }
    
    .partner-count {
      padding: 12px;
      background: linear-gradient(135deg, #F5F5F5 0%, #E8E8E8 100%);
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }
    
    .partner-count strong {
      font-size: 20px;
      color: #7B8E7E;
      font-weight: 700;
    }
    
    /* ì—…ì²´ ëª©ë¡ */
    .partner-list {
      margin-top: 24px;
      border-top: 2px solid #F0F0F0;
      padding-top: 16px;
    }
    
    .partner-list-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .sort-dropdown {
      font-size: 12px;
      padding: 4px 8px;
      border: 1px solid #E0E0E0;
      border-radius: 4px;
      background: white;
      cursor: pointer;
    }
    
    .partner-items {
      max-height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .partner-items::-webkit-scrollbar {
      width: 6px;
    }
    
    .partner-items::-webkit-scrollbar-track {
      background: #F5F5F5;
      border-radius: 3px;
    }
    
    .partner-items::-webkit-scrollbar-thumb {
      background: #C0C0C0;
      border-radius: 3px;
    }
    
    .partner-items::-webkit-scrollbar-thumb:hover {
      background: #A0A0A0;
    }
    
    .partner-item {
      padding: 12px;
      border: 2px solid #E0E0E0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }
    
    .partner-item:hover {
      border-color: #7B8E7E;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .partner-item.active {
      border-color: #7B8E7E;
      background: #F5F9F6;
    }
    
    .partner-item.favorited {
      border-color: #FFB900;
      background: #FFFAF0;
    }
    
    .partner-item-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 6px;
    }
    
    .partner-item-name {
      font-size: 14px;
      font-weight: 600;
      color: #2C2C2C;
      flex: 1;
    }
    
    .partner-item-favorite {
      font-size: 18px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .partner-item-favorite:hover {
      transform: scale(1.2);
    }
    
    .partner-item-favorite.active {
      color: #FFB900;
    }
    
    .partner-item-info {
      font-size: 12px;
      color: #888;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }
    
    .partner-item-distance {
      color: #7B8E7E;
      font-weight: 600;
    }
    
    .partner-item-category {
      display: inline-block;
      padding: 2px 6px;
      background: #E8F5E9;
      color: #5A6B5D;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
    }
    
    /* ì§€ë„ ì˜ì—­ */
    .map-wrapper {
      flex: 1;
      min-width: 0;
      position: relative;
    }
    
    /* ê²€ìƒ‰ ë°” */
    .search-bar {
      position: absolute;
      top: 16px;
      left: 16px;
      right: 70px;
      z-index: 100;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .search-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      border: 2px solid #E0E0E0;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #7B8E7E;
      box-shadow: 0 4px 12px rgba(123,142,126,0.2);
    }
    
    .search-btn {
      padding: 12px 16px;
      background: white;
      border: 2px solid #E0E0E0;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      white-space: nowrap;
    }
    
    .search-btn:hover {
      border-color: #7B8E7E;
      background: #F5F5F5;
    }
    
    .search-btn.active {
      background: #7B8E7E;
      color: white;
      border-color: #7B8E7E;
    }
    
    /* ì§€ë„ ì»¨íŠ¸ë¡¤ */
    .map-controls {
      position: absolute;
      top: 16px;
      right: 16px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .map-control-btn {
      width: 40px;
      height: 40px;
      background: white;
      border: 2px solid #E0E0E0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      font-size: 18px;
    }
    
    .map-control-btn:hover {
      border-color: #7B8E7E;
      background: #F5F5F5;
    }
    
    .map-control-btn.active {
      background: #7B8E7E;
      color: white;
      border-color: #7B8E7E;
    }
    
    /* ìƒì„¸ ëª¨ë‹¬ */
    .detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }
    
    .detail-modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .detail-modal-content {
      background: white;
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    
    .detail-modal-header {
      position: sticky;
      top: 0;
      background: white;
      padding: 24px;
      border-bottom: 2px solid #F0F0F0;
      display: flex;
      justify-content: space-between;
      align-items: start;
      border-radius: 16px 16px 0 0;
      z-index: 10;
    }
    
    .detail-modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #2C2C2C;
      flex: 1;
    }
    
    .detail-modal-close {
      width: 32px;
      height: 32px;
      background: #F5F5F5;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.2s;
    }
    
    .detail-modal-close:hover {
      background: #E0E0E0;
    }
    
    .detail-modal-body {
      padding: 24px;
    }
    
    .detail-modal-image {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .detail-modal-section {
      margin-bottom: 24px;
    }
    
    .detail-modal-section-title {
      font-size: 16px;
      font-weight: 600;
      color: #2C2C2C;
      margin-bottom: 12px;
    }
    
    .detail-modal-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 24px;
    }
    
    .detail-modal-btn {
      padding: 14px;
      border: 2px solid #7B8E7E;
      background: white;
      color: #7B8E7E;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .detail-modal-btn:hover {
      background: #7B8E7E;
      color: white;
    }
    
    .detail-modal-btn.primary {
      background: #7B8E7E;
      color: white;
    }
    
    .detail-modal-btn.primary:hover {
      background: #5A6B5D;
    }
    
    /* ì§€ë„ ì»¨í…Œì´ë„ˆ */
    .map-container { 
      position: relative; 
      width: 100%; 
      height: 600px; 
      background-color: #E5E3DC; 
      margin: 0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    #map { 
      width: 100%; 
      height: 100%; 
    }
    
    .map-loading { 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      text-align: center; 
      color: #666; 
      font-size: 16px; 
      z-index: 1000; 
      background-color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .map-loading.hidden { 
      display: none; 
    }
    
    /* InfoWindow ìŠ¤íƒ€ì¼ */
    .custom-infowindow {
      background-color: white;
      border-radius: 16px;
      padding: 0;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      min-width: 280px;
      max-width: 320px;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', sans-serif;
      position: relative;
    }
    
    /* ë‹«ê¸° ë²„íŠ¼ */
    .info-close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 28px;
      height: 28px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      line-height: 1;
      z-index: 10;
      transition: all 0.2s;
    }
    
    .info-close-btn:hover {
      background: rgba(0, 0, 0, 0.7);
      transform: scale(1.1);
    }
    
    .info-image-container {
      width: 100%;
      height: 180px;
      overflow: hidden;
      background: linear-gradient(135deg, #F5F5F5 0%, #E0E0E0 100%);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .info-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .info-image:not([src]),
    .info-image[src=""] {
      display: none;
    }
    
    .info-image-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 48px;
    }
    
    .info-content {
      padding: 16px;
    }
    
    .info-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    
    .info-name {
      font-size: 18px;
      font-weight: 700;
      color: #2C2C2C;
      margin: 0;
      line-height: 1.4;
      flex: 1;
      max-width: 180px;
      word-break: keep-all;
      overflow-wrap: break-word;
    }
    
    .info-badge {
      display: inline-block;
      background: linear-gradient(135deg, #7B8E7E, #5A6B5D);
      color: white;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
      white-space: nowrap;
    }
    
    .info-description {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 12px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      word-break: keep-all;
      overflow-wrap: break-word;
    }
    
    .info-details {
      font-size: 13px;
      color: #888;
      margin-bottom: 12px;
      padding-top: 12px;
      border-top: 1px solid #F0F0F0;
    }
    
    .info-detail-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    
    .info-detail-item:last-child {
      margin-bottom: 0;
    }
    
    .info-detail-icon {
      margin-right: 8px;
      font-size: 14px;
      width: 20px;
      text-align: center;
    }
    
    .info-detail-text {
      flex: 1;
      word-break: keep-all;
      overflow-wrap: break-word;
      line-height: 1.5;
    }
    
    .info-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    
    /* ë§í¬ ë“œë¡­ë‹¤ìš´ */
    .info-links-dropdown {
      position: relative;
      flex: 1;
      min-width: calc(50% - 4px);
    }
    
    .info-links-toggle {
      width: 100%;
      padding: 10px 12px;
      background-color: #7B8E7E;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .info-links-toggle:hover {
      background-color: #5A6B5D;
    }
    
    .info-links-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      overflow: hidden;
    }
    
    .info-links-menu.show {
      display: block;
    }
    
    .info-links-menu a {
      display: block;
      padding: 12px 16px;
      color: #333;
      text-decoration: none;
      font-size: 13px;
      border-bottom: 1px solid #eee;
      transition: background 0.2s;
    }
    
    .info-links-menu a:last-child {
      border-bottom: none;
    }
    
    .info-links-menu a:hover {
      background-color: #f5f5f5;
    }
    
    .info-btn {
      flex: 1;
      min-width: calc(50% - 4px);
      padding: 10px 12px;
      background-color: #7B8E7E;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .info-btn:hover {
      background-color: #5A6B5D;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .info-btn.secondary {
      background-color: #F5F5F5;
      color: #666;
      border: 1px solid #E0E0E0;
    }
    
    .info-btn.secondary:hover {
      background-color: #E8E8E8;
      color: #333;
    }
    
    /* ë§í¬ ë“œë¡­ë‹¤ìš´ */
    .info-links-dropdown {
      position: relative;
    }
    
    .info-links-toggle {
      width: 100%;
      padding: 10px 12px;
      background-color: #7B8E7E;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .info-links-toggle:hover {
      background-color: #5A6B5D;
    }
    
    .info-links-menu {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 2px solid #7B8E7E;
      border-radius: 8px;
      margin-bottom: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 100;
    }
    
    .info-links-menu.show {
      display: block;
    }
    
    .info-links-menu a {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      color: #2C2C2C;
      text-decoration: none;
      border-bottom: 1px solid #F0F0F0;
      transition: background 0.2s;
    }
    
    .info-links-menu a:last-child {
      border-bottom: none;
    }
    
    .info-links-menu a:hover {
      background: #F5F5F5;
    }
    
    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        position: static;
      }
      
      .map-wrapper {
        width: 100%;
      }
      
      .search-bar {
        flex-direction: column;
        right: 16px;
      }
      
      .search-input {
        width: 100%;
      }
      
      .search-btn {
        width: 100%;
      }
    }
    
    @media (max-width: 768px) {
      .page-title { 
        font-size: 24px; 
      }
      
      .page-subtitle { 
        font-size: 14px; 
      }
      
      .map-container { 
        height: 500px; 
        margin: 10px;
        border-radius: 8px;
      }
      
      .custom-infowindow {
        min-width: 260px;
        max-width: 280px;
      }
      
      .info-image-container {
        height: 150px;
      }
      
      .info-name {
        font-size: 16px;
      }
      
      .info-content {
        padding: 14px;
      }
      
      .info-actions {
        flex-direction: column;
      }
      
      .info-btn,
      .info-links-dropdown {
        width: 100%;
        min-width: 100%;
      }
    }
    
    @media (max-width: 480px) {
      .custom-infowindow {
        min-width: 240px;
        max-width: 260px;
      }
      
      .info-image-container {
        height: 120px;
      }
    }
    
    /* ========================================
       ìƒì„¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼
       ======================================== */
    
    #detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    
    #detail-modal.show {
      display: flex;
    }
    
    .detail-modal-content {
      background: white;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .detail-modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .detail-modal-header h2 {
      margin: 0;
      font-size: 20px;
      font-weight: bold;
    }
    
    .detail-modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .detail-modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }
    
    .detail-modal-body {
      padding: 20px;
      max-height: calc(90vh - 160px);
      overflow-y: auto;
    }
    
    .detail-modal-image {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .detail-modal-section {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .detail-modal-section:last-of-type {
      border-bottom: none;
    }
    
    .detail-modal-section-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 12px;
    }
    
    .detail-modal-section p {
      margin: 8px 0;
      color: #555;
      line-height: 1.6;
    }
    
    .detail-modal-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    
    .detail-modal-btn {
      padding: 14px 16px;
      background-color: #7B8E7E;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .detail-modal-btn:hover {
      background-color: #5A6B5D;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .detail-modal-btn.primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .detail-modal-btn.primary:hover {
      background: linear-gradient(135deg, #5568d3 0%, #63408d 100%);
    }
    
    @media (max-width: 768px) {
      .detail-modal-content {
        width: 95%;
        max-height: 95vh;
      }
      
      .detail-modal-actions {
        grid-template-columns: 1fr;
      }
      
      .detail-modal-image {
        height: 180px;
      }
    }
  </style>
</head>
<body>
  
  <div class="page-header">
    <h1 class="page-title">ğŸ—ºï¸ ì œíœ´ì—…ì²´ ì°¾ê¸°</h1>
    <p class="page-subtitle">ì „êµ­ ì œíœ´ì—…ì²´ ìœ„ì¹˜ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
  </div>
  
  <div id="status-notice" class="status-notice status-loading">
    <h3>ğŸ“Š ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</h3>
    <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
  </div>
  
  <div class="main-container">
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
      <h2 class="sidebar-title">ğŸ” íŒŒíŠ¸ë„ˆ ê³µë°© ì°¾ê¸°</h2>
      
      <!-- ê²€ìƒ‰ì°½ -->
      <div class="search-box">
        <input type="text" 
               id="search-input" 
               class="search-input" 
               placeholder="ğŸ” ì—…ì²´ëª…ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." 
               autocomplete="off">
      </div>
      
      <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
      <div class="quick-actions">
        <button class="quick-btn" id="btn-my-location" title="ë‚´ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬">
          ğŸ“ ê·¼ì²˜
        </button>
        <button class="quick-btn" id="btn-favorites" title="ì¦ê²¨ì°¾ê¸° ëª©ë¡ ë³´ê¸°">
          â­ ì°œ <span id="favorites-count">(0)</span>
        </button>
      </div>
      
      <div class="partner-count">
        <div>ì „ì²´ <strong id="total-count">0</strong>ê°œ</div>
      </div>
      
      <!-- ì§€ì—­ í•„í„° -->
      <div class="filter-section">
        <div class="filter-label">ğŸ“ ì§€ì—­</div>
        <div class="filter-buttons" id="region-filters">
          <button class="filter-btn active" data-value="all">ì „ì²´</button>
        </div>
      </div>
      
      <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
      <div class="filter-section">
        <div class="filter-label">ğŸ·ï¸ ê³µì˜ˆ ì¢…ë¥˜</div>
        <div class="filter-buttons" id="category-filters">
          <button class="filter-btn active" data-value="all">ì „ì²´</button>
        </div>
      </div>
      
      <!-- í˜‘íšŒ í•„í„° -->
      <div class="filter-section">
        <div class="filter-label">ğŸ›ï¸ í˜‘íšŒ</div>
        <div class="filter-buttons" id="association-filters">
          <button class="filter-btn active" data-value="all">ì „ì²´</button>
        </div>
      </div>
      
      <!-- ì—…ì²´ ëª©ë¡ -->
      <div class="partner-list">
        <div class="partner-list-title">
          <span>ğŸ“‹ ì—…ì²´ ëª©ë¡</span>
          <select class="sort-dropdown" id="sort-select">
            <option value="name">ì´ë¦„ìˆœ</option>
            <option value="distance">ê±°ë¦¬ìˆœ</option>
          </select>
        </div>
        <div class="partner-items" id="partner-items">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
        </div>
      </div>
    </div>
    
    <!-- ì§€ë„ ì˜ì—­ -->
    <div class="map-wrapper">
      <!-- ê²€ìƒ‰ ë°” -->
      <div class="search-bar">
        <input type="text" id="search-input" class="search-input" placeholder="ì—…ì²´ëª… ê²€ìƒ‰...">
        <button class="search-btn" id="btn-my-location">ğŸ“ ê·¼ì²˜</button>
        <button class="search-btn" id="btn-favorites">â­ ì°œ</button>
      </div>
      
      <!-- ì§€ë„ ì»¨íŠ¸ë¡¤ -->
      <div class="map-controls">
        <button class="map-control-btn" id="btn-map-style" title="ì§€ë„ ìŠ¤íƒ€ì¼ ë³€ê²½">
          ğŸ—ºï¸
        </button>
      </div>
      
      <div class="map-container">
        <div id="map"></div>
        <div class="map-loading" id="map-loading">
          <div style="font-size: 48px; margin-bottom: 16px;">ğŸ—ºï¸</div>
          <div>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ìƒì„¸ ëª¨ë‹¬ -->
  <div class="detail-modal" id="detail-modal">
    <div class="detail-modal-content">
      <div class="detail-modal-header">
        <h2 class="detail-modal-title" id="modal-title"></h2>
        <button class="detail-modal-close" id="modal-close">Ã—</button>
      </div>
      <div class="detail-modal-body" id="modal-body">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
      </div>
    </div>
  </div>
  
  <script>
    // ========================================
    // ğŸ”§ ì„¤ì •: ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ì„¸ìš”!
    // ========================================
    
    // Google Apps Script ì›¹ ì•± URL
    var GOOGLE_SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbxfp4SbpsUCmQu0gnF02r8oMY0dzzadElkcTcFNSsxPNo3x4zsNcw-z8MvJ3F7xskP6Yw/exec';
    //                          â†‘â†‘â†‘ ì—¬ê¸°ì— ë°œê¸‰ë°›ì€ URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”
    
    // ë””ë²„ê·¸ ëª¨ë“œ (trueë¡œ ì„¤ì •í•˜ë©´ ì½˜ì†”ì— ìƒì„¸ ë¡œê·¸ ì¶œë ¥)
    var DEBUG_MODE = true;
    
    // ========================================
    // ì „ì—­ ë³€ìˆ˜
    // ========================================
    var partnersData = [];
    var filteredPartnersData = []; // í•„í„°ë§ëœ ë°ì´í„°
    var map = null;
    var markers = [];
    var infowindows = [];
    var currentInfoWindow = null; // í˜„ì¬ ì—´ë¦° InfoWindow ì¶”ì 
    
    // í•„í„° ìƒíƒœ
    var currentFilters = {
      region: 'all',
      category: 'all',
      association: 'all'
    };
    
    // í˜„ì¬ ìœ„ì¹˜
    var userLocation = null;
    
    // ì¦ê²¨ì°¾ê¸° (ë¡œì»¬ ì €ì¥ì†Œ)
    var favorites = [];
    
    // ê²€ìƒ‰ì–´
    var searchQuery = '';
    
    // ì •ë ¬ ë°©ì‹
    var sortBy = 'name'; // 'name' or 'distance'
    
    // ì§€ë„ ìŠ¤íƒ€ì¼
    var mapStyle = 'normal'; // 'normal' or 'satellite'
    
    // ========================================
    // InfoWindow ë‹«ê¸° í•¨ìˆ˜ (ì „ì—­)
    // ========================================
    window.closeInfoWindow = function() {
      if (currentInfoWindow) {
        currentInfoWindow.close();
        currentInfoWindow = null;
      }
    };
    
    // ========================================
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    // ========================================
    
    // ë¡œì»¬ ì €ì¥ì†Œ: ì¦ê²¨ì°¾ê¸° ë¡œë“œ
    function loadFavorites() {
      try {
        var stored = localStorage.getItem('partner_favorites');
        favorites = stored ? JSON.parse(stored) : [];
        updateFavoritesCount();
      } catch (e) {
        favorites = [];
      }
    }
    
    // ë¡œì»¬ ì €ì¥ì†Œ: ì¦ê²¨ì°¾ê¸° ì €ì¥
    function saveFavorites() {
      try {
        localStorage.setItem('partner_favorites', JSON.stringify(favorites));
        updateFavoritesCount();
      } catch (e) {
        console.error('ì¦ê²¨ì°¾ê¸° ì €ì¥ ì‹¤íŒ¨:', e);
      }
    }
    
    // ì¦ê²¨ì°¾ê¸° ì¶”ê°€/ì œê±°
    function toggleFavorite(partnerName) {
      var index = favorites.indexOf(partnerName);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push(partnerName);
      }
      saveFavorites();
      renderPartnerList();
    }
    
    // ì¦ê²¨ì°¾ê¸° í™•ì¸
    function isFavorite(partnerName) {
      return favorites.indexOf(partnerName) > -1;
    }
    
    // ì¦ê²¨ì°¾ê¸° ê°œìˆ˜ ì—…ë°ì´íŠ¸
    function updateFavoritesCount() {
      var countEl = document.getElementById('favorites-count');
      if (countEl) {
        countEl.textContent = '(' + favorites.length + ')';
      }
    }
    
    // ê±°ë¦¬ ê³„ì‚° (Haversine formula)
    function calculateDistance(lat1, lng1, lat2, lng2) {
      var R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
      var dLat = (lat2 - lat1) * Math.PI / 180;
      var dLng = (lng2 - lng1) * Math.PI / 180;
      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLng/2) * Math.sin(dLng/2);
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
    
    // ê±°ë¦¬ í¬ë§·íŒ…
    function formatDistance(km) {
      if (km < 1) {
        return Math.round(km * 1000) + 'm';
      } else {
        return km.toFixed(1) + 'km';
      }
    }
    
    // ë°ì´í„° ë¶„ë¦¬ (ì‰¼í‘œ, íŒŒì´í”„, ì¤„ë°”ê¿ˆ)
    function splitData(text) {
      if (!text || text.trim() === '') return [];
      return text.split(/[,|\n]+/).map(function(item) {
        return item.trim();
      }).filter(function(item) {
        return item !== '';
      });
    }
    
    // URL íŒŒë¼ë¯¸í„° ì½ê¸°
    function getUrlParams() {
      var params = {};
      var search = window.location.search.substring(1);
      if (search) {
        var pairs = search.split('&');
        pairs.forEach(function(pair) {
          var parts = pair.split('=');
          params[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1] || '');
        });
      }
      return params;
    }
    
    // URL íŒŒë¼ë¯¸í„° ì„¤ì •
    function setUrlParams(params) {
      var searchParams = new URLSearchParams();
      Object.keys(params).forEach(function(key) {
        if (params[key] && params[key] !== 'all' && params[key] !== '') {
          searchParams.set(key, params[key]);
        }
      });
      var newUrl = window.location.pathname + (searchParams.toString() ? '?' + searchParams.toString() : '');
      window.history.replaceState({}, '', newUrl);
    }
    
    // ========================================
    // ìœ í‹¸ë¦¬í‹°: ë¡œê¹…
    // ========================================
    function debugLog(message, data) {
      if (DEBUG_MODE) {
        console.log('[ì œíœ´ì—…ì²´ì§€ë„]', message, data || '');
      }
    }
    
    // ========================================
    // ìƒíƒœ í‘œì‹œ
    // ========================================
    function showStatus(type, title, message, details) {
      var notice = document.getElementById('status-notice');
      if (!notice) return;
      
      notice.className = 'status-notice status-' + type;
      
      var html = '<h3>' + title + '</h3><p>' + message + '</p>';
      
      if (details && type === 'error') {
        html += '<div class="error-details"><strong>ìƒì„¸ ì •ë³´:</strong><br>' + details + '</div>';
      }
      
      notice.innerHTML = html;
      notice.style.display = 'block';
    }
    
    function hideStatus() {
      var notice = document.getElementById('status-notice');
      if (notice) {
        notice.style.display = 'none';
      }
    }
    
    // ========================================
    // êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì´ë¯¸ì§€ URL ë³€í™˜
    // ========================================
    function convertGoogleDriveUrl(url) {
      if (!url || url.trim() === '') {
        return null;
      }
      
      var trimmedUrl = url.trim();
      
      // ì´ë¯¸ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥í•œ URLì¸ ê²½ìš° (ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° URL)
      if (trimmedUrl.includes('drive.google.com/uc?') || trimmedUrl.includes('lh3.googleusercontent.com')) {
        return trimmedUrl;
      }
      
      // êµ¬ê¸€ ë“œë¼ì´ë¸Œ ê³µìœ  ë§í¬ì—ì„œ íŒŒì¼ ID ì¶”ì¶œ
      // í˜•ì‹: https://drive.google.com/file/d/FILE_ID/view
      // ë˜ëŠ”: https://drive.google.com/open?id=FILE_ID
      var fileId = null;
      
      var match1 = trimmedUrl.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
      if (match1) {
        fileId = match1[1];
      } else {
        var match2 = trimmedUrl.match(/[?&]id=([a-zA-Z0-9_-]+)/);
        if (match2) {
          fileId = match2[1];
        }
      }
      
      if (fileId) {
        // ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL ìƒì„± (ìµœëŒ€ 800px ë„ˆë¹„)
        return 'https://drive.google.com/uc?export=view&id=' + fileId;
      }
      
      // íŒŒì¼ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´ ì›ë³¸ URL ë°˜í™˜
      return trimmedUrl;
    }
    
    // ========================================
    // ë°ì´í„° ë¡œë“œ
    // ========================================
    function loadPartnersData() {
      debugLog('ë°ì´í„° ë¡œë“œ ì‹œì‘', GOOGLE_SHEET_API_URL);
      
      showStatus('loading', 'ğŸ“Š ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...', 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
      
      fetch(GOOGLE_SHEET_API_URL)
        .then(function(response) {
          debugLog('ì‘ë‹µ ìˆ˜ì‹ :', {
            status: response.status,
            ok: response.ok
          });
          
          if (!response.ok) {
            throw new Error('API ì‘ë‹µ ì˜¤ë¥˜ (HTTP ' + response.status + ')');
          }
          
          return response.json();
        })
        .then(function(data) {
          debugLog('ë°ì´í„° íŒŒì‹± ì™„ë£Œ:', data);
          
          // ì—ëŸ¬ ì‘ë‹µ ì²´í¬
          if (data.error || data.success === false) {
            throw new Error(data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
          
          // ë°ì´í„° êµ¬ì¡° í™•ì¸
          if (!data.partners || !Array.isArray(data.partners)) {
            throw new Error('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹: partners ë°°ì—´ì´ ì—†ìŠµë‹ˆë‹¤.');
          }
          
          if (data.partners.length === 0) {
            showStatus('error', 
              'âš ï¸ í‘œì‹œí•  ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤',
              'êµ¬ê¸€ ì‹œíŠ¸ì— ì‹¬ì‚¬ìƒíƒœê°€ "ìŠ¹ì¸"ì´ê³  ìœ„ë„/ê²½ë„ê°€ ì…ë ¥ëœ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.',
              'ê´€ë¦¬ìê°€ ì—…ì²´ë¥¼ ìŠ¹ì¸í•˜ê³  ì£¼ì†Œê°€ ìë™ìœ¼ë¡œ ì¢Œí‘œë¡œ ë³€í™˜ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.'
            );
            return;
          }
          
          partnersData = data.partners;
          filteredPartnersData = partnersData; // ì´ˆê¸°ì—ëŠ” ì „ì²´ ë°ì´í„°
          
          // í•„í„° ì´ˆê¸°í™”
          initializeFilters();
          
          // ìƒíƒœ ìˆ¨ê¹€
          hideStatus();
          
          // ì§€ë„ì— ë§ˆì»¤ ìƒì„±
          if (map) {
            createMarkers();
          }
          
          debugLog('ë¡œë“œ ì™„ë£Œ:', partnersData.length + 'ê°œ ì—…ì²´');
        })
        .catch(function(error) {
          console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          
          var errorMsg = error.message || error.toString();
          var helpMsg = '';
          
          // ì—ëŸ¬ ìœ í˜•ë³„ ë„ì›€ë§
          if (errorMsg.indexOf('Failed to fetch') > -1 || errorMsg.indexOf('NetworkError') > -1) {
            helpMsg = 'URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”: ' + GOOGLE_SHEET_API_URL;
          } else if (errorMsg.indexOf('Unauthorized') > -1) {
            helpMsg = 'Apps Script ë°°í¬ ì„¤ì •ì—ì„œ "ì•¡ì„¸ìŠ¤ ê¶Œí•œ"ì„ "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •í•˜ì„¸ìš”.';
          }
          
          showStatus('error',
            'âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
            errorMsg,
            helpMsg + '<br><br>F12 í‚¤ë¥¼ ëˆŒëŸ¬ ê°œë°œì ë„êµ¬ì˜ Console íƒ­ì—ì„œ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
          );
        });
    }
    
    // ========================================
    // ì§€ë„ ì´ˆê¸°í™”
    // ========================================
    function initMap() {
      try {
        document.getElementById('map-loading').classList.add('hidden');
        
        var mapOptions = {
          center: new naver.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ì‹œì²­ ê¸°ë³¸ ì¤‘ì‹¬
          zoom: 11,
          zoomControl: true,
          zoomControlOptions: { 
            position: naver.maps.Position.TOP_RIGHT 
          },
          mapTypeControl: true
        };
        
        map = new naver.maps.Map('map', mapOptions);
        
        debugLog('ì§€ë„ ì´ˆê¸°í™” ì„±ê³µ');
        
        // ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì—ˆìœ¼ë©´ ë§ˆì»¤ ìƒì„±
        if (partnersData.length > 0) {
          createMarkers();
        }
      } catch (error) {
        console.error('âŒ ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        document.getElementById('map-loading').innerHTML = 
          '<div style="color: #C17B7B;">' +
          '<div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>' +
          '<div>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>' +
          '<div style="font-size:12px; margin-top:8px;">ë„¤ì´ë²„ ì§€ë„ API Client IDë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”</div>' +
          '</div>';
      }
    }
    
    // ========================================
    // í•„í„° ê´€ë ¨ í•¨ìˆ˜
    // ========================================
    
    // ì§€ì—­ ì¶”ì¶œ í•¨ìˆ˜
    function extractRegion(address) {
      if (!address) return 'ê¸°íƒ€';
      
      // ì‹œ/ë„ ì¶”ì¶œ
      var match = address.match(/^([^ì‹œë„êµ°êµ¬]+[ì‹œë„])/);
      if (match) {
        return match[1];
      }
      
      // íŠ¹ë³„ì‹œ/ê´‘ì—­ì‹œ ì¶”ì¶œ
      match = address.match(/^(ì„œìš¸|ë¶€ì‚°|ëŒ€êµ¬|ì¸ì²œ|ê´‘ì£¼|ëŒ€ì „|ìš¸ì‚°|ì„¸ì¢…)/);
      if (match) {
        return match[1];
      }
      
      return 'ê¸°íƒ€';
    }
    
    // í•„í„° ì´ˆê¸°í™”
    function initializeFilters() {
      var regions = new Set();
      var categories = new Set();
      var associations = new Set();
      
      partnersData.forEach(function(partner) {
        // ì§€ì—­ ì¶”ì¶œ
        var region = extractRegion(partner.address);
        regions.add(region);
        
        // ì¹´í…Œê³ ë¦¬ (ì‰¼í‘œë¡œ ë¶„ë¦¬)
        if (partner.category) {
          var cats = splitData(partner.category);
          cats.forEach(function(cat) {
            if (cat) categories.add(cat);
          });
        }
        
        // í˜‘íšŒ (ì‰¼í‘œë¡œ ë¶„ë¦¬)
        if (partner.association) {
          var assocs = splitData(partner.association);
          assocs.forEach(function(assoc) {
            if (assoc) associations.add(assoc);
          });
        }
      });
      
      // ì§€ì—­ í•„í„° ë²„íŠ¼ ìƒì„±
      var regionFilters = document.getElementById('region-filters');
      regionFilters.innerHTML = '<button class="filter-btn active" data-value="all">ì „ì²´</button>';
      Array.from(regions).sort().forEach(function(region) {
        var btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.setAttribute('data-value', region);
        btn.textContent = region;
        btn.onclick = function() { setFilter('region', region); };
        regionFilters.appendChild(btn);
      });
      
      // ì¹´í…Œê³ ë¦¬ í•„í„° ë²„íŠ¼ ìƒì„±
      var categoryFilters = document.getElementById('category-filters');
      categoryFilters.innerHTML = '<button class="filter-btn active" data-value="all">ì „ì²´</button>';
      Array.from(categories).sort().forEach(function(category) {
        var btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.setAttribute('data-value', category);
        btn.textContent = category;
        btn.onclick = function() { setFilter('category', category); };
        categoryFilters.appendChild(btn);
      });
      
      // í˜‘íšŒ í•„í„° ë²„íŠ¼ ìƒì„±
      var associationFilters = document.getElementById('association-filters');
      associationFilters.innerHTML = '<button class="filter-btn active" data-value="all">ì „ì²´</button>';
      Array.from(associations).sort().forEach(function(association) {
        var btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.setAttribute('data-value', association);
        btn.textContent = association;
        btn.onclick = function() { setFilter('association', association); };
        associationFilters.appendChild(btn);
      });
      
      // "ì „ì²´" ë²„íŠ¼ ì´ë²¤íŠ¸
      regionFilters.querySelector('[data-value="all"]').onclick = function() { setFilter('region', 'all'); };
      categoryFilters.querySelector('[data-value="all"]').onclick = function() { setFilter('category', 'all'); };
      associationFilters.querySelector('[data-value="all"]').onclick = function() { setFilter('association', 'all'); };
      
      // ì—…ì²´ ìˆ˜ ì—…ë°ì´íŠ¸
      updatePartnerCount();
    }
    
    // í•„í„° ì„¤ì •
    function setFilter(filterType, value) {
      currentFilters[filterType] = value;
      
      // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
      var containerId = filterType + '-filters';
      var buttons = document.getElementById(containerId).querySelectorAll('.filter-btn');
      buttons.forEach(function(btn) {
        if (btn.getAttribute('data-value') === value) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      // í•„í„°ë§ ì ìš©
      applyFilters();
    }
    
    // í•„í„°ë§ ì ìš©
    function applyFilters() {
      filteredPartnersData = partnersData.filter(function(partner) {
        // ê²€ìƒ‰ í•„í„°
        if (searchQuery) {
          var nameMatch = partner.name && partner.name.toLowerCase().indexOf(searchQuery.toLowerCase()) > -1;
          if (!nameMatch) return false;
        }
        
        // ì§€ì—­ í•„í„°
        if (currentFilters.region !== 'all') {
          var region = extractRegion(partner.address);
          if (region !== currentFilters.region) {
            return false;
          }
        }
        
        // ì¹´í…Œê³ ë¦¬ í•„í„° (ë¶„ë¦¬ëœ ë°ì´í„° ì²˜ë¦¬)
        if (currentFilters.category !== 'all') {
          var cats = splitData(partner.category);
          if (cats.indexOf(currentFilters.category) === -1) {
            return false;
          }
        }
        
        // í˜‘íšŒ í•„í„° (ë¶„ë¦¬ëœ ë°ì´í„° ì²˜ë¦¬)
        if (currentFilters.association !== 'all') {
          var assocs = splitData(partner.association);
          if (assocs.indexOf(currentFilters.association) === -1) {
            return false;
          }
        }
        
        return true;
      });
      
      // ì¦ê²¨ì°¾ê¸° í•„í„° (í™œì„±í™”ëœ ê²½ìš°)
      var favBtn = document.getElementById('btn-favorites');
      if (favBtn && favBtn.classList.contains('active')) {
        filteredPartnersData = filteredPartnersData.filter(function(partner) {
          return isFavorite(partner.name);
        });
      }
      
      // ì •ë ¬
      sortPartners();
      
      // ë§ˆì»¤ ì¬ìƒì„±
      createMarkers();
      
      // ì—…ì²´ ëª©ë¡ ë Œë”ë§
      renderPartnerList();
      
      // ì—…ì²´ ìˆ˜ ì—…ë°ì´íŠ¸
      updatePartnerCount();
      
      // URL ìƒíƒœ ì €ì¥
      setUrlParams({
        region: currentFilters.region,
        category: currentFilters.category,
        association: currentFilters.association,
        search: searchQuery
      });
      
      updatePartnerCount();
    }
    
    // ì—…ì²´ ìˆ˜ ì—…ë°ì´íŠ¸
    function updatePartnerCount() {
      var countElement = document.getElementById('total-count');
      if (countElement) {
        countElement.textContent = filteredPartnersData.length;
      }
    }
    
    // ì—…ì²´ ì •ë ¬
    function sortPartners() {
      if (sortBy === 'distance' && userLocation) {
        filteredPartnersData.sort(function(a, b) {
          var distA = calculateDistance(userLocation.lat, userLocation.lng, a.lat, a.lng);
          var distB = calculateDistance(userLocation.lat, userLocation.lng, b.lat, b.lng);
          return distA - distB;
        });
      } else {
        // ì´ë¦„ìˆœ
        filteredPartnersData.sort(function(a, b) {
          return (a.name || '').localeCompare(b.name || '');
        });
      }
    }
    
    // ì—…ì²´ ëª©ë¡ ë Œë”ë§
    function renderPartnerList() {
      var container = document.getElementById('partner-items');
      if (!container) return;
      
      container.innerHTML = '';
      
      filteredPartnersData.forEach(function(partner) {
        var item = document.createElement('div');
        item.className = 'partner-item';
        if (isFavorite(partner.name)) {
          item.classList.add('favorited');
        }
        
        var distance = '';
        if (userLocation) {
          var dist = calculateDistance(userLocation.lat, userLocation.lng, partner.lat, partner.lng);
          distance = '<span class="partner-item-distance">ğŸ“ ' + formatDistance(dist) + '</span>';
        }
        
        var categories = splitData(partner.category).slice(0, 2).join(', ');
        if (splitData(partner.category).length > 2) {
          categories += '...';
        }
        
        item.innerHTML = 
          '<div class="partner-item-header">' +
          '<div class="partner-item-name">' + escapeHtml(partner.name) + '</div>' +
          '<div class="partner-item-favorite ' + (isFavorite(partner.name) ? 'active' : '') + '" ' +
          'data-name="' + escapeHtml(partner.name) + '">â˜…</div>' +
          '</div>' +
          '<div class="partner-item-info">' +
          distance +
          '<span class="partner-item-category">' + escapeHtml(categories || 'ê³µë°©') + '</span>' +
          '</div>';
        
        item.onclick = function(e) {
          if (!e.target.classList.contains('partner-item-favorite')) {
            focusOnPartner(partner);
          }
        };
        
        var favBtn = item.querySelector('.partner-item-favorite');
        favBtn.onclick = function(e) {
          e.stopPropagation();
          toggleFavorite(partner.name);
        };
        
        container.appendChild(item);
      });
    }
    
    // ì—…ì²´ì— í¬ì»¤ìŠ¤
    function focusOnPartner(partner) {
      if (!map) return;
      
      var position = new naver.maps.LatLng(partner.lat, partner.lng);
      map.setCenter(position);
      map.setZoom(16);
      
      // í•´ë‹¹ ë§ˆì»¤ì˜ InfoWindow ì—´ê¸°
      markers.forEach(function(item) {
        if (item.partner.name === partner.name) {
          naver.maps.Event.trigger(item.marker, 'click');
        }
      });
    }
    
    // ========================================
    // ë§ˆì»¤ ìƒì„±
    // ========================================
    function createMarkers() {
      debugLog('ë§ˆì»¤ ìƒì„± ì‹œì‘');
      
      // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
      markers.forEach(function(item) {
        item.marker.setMap(null);
      });
      markers = [];
      infowindows = [];
      
      var createdCount = 0;
      
      // ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì˜¤ë¥˜ í‘œì‹œ
      if (!map || typeof naver === 'undefined' || !naver.maps) {
        console.error('âŒ ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        showStatus('error',
          'âš ï¸ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨',
          'ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',
          'í•´ê²° ë°©ë²•:<br><br>' +
          '1. ë„¤ì´ë²„ í´ë¼ìš°ë“œ í”Œë«í¼ ì½˜ì†” ì ‘ì†<br>' +
          '2. Maps â†’ Application â†’ Web Service URL í™•ì¸<br>' +
          '3. http://localhost ë˜ëŠ” http://localhost:8080 ë“±ë¡ í™•ì¸<br>' +
          '4. ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ (Cmd+Shift+R)<br>' +
          '5. 5~10ë¶„ ëŒ€ê¸° í›„ ì¬ì‹œë„'
        );
        return;
      }
      
      var bounds = new naver.maps.LatLngBounds();
      
      filteredPartnersData.forEach(function(partner, index) {
        // ìœ„ë„/ê²½ë„ ê²€ì¦
        if (!partner.lat || !partner.lng || partner.lat === 0 || partner.lng === 0) {
          console.warn('âš ï¸ ì¢Œí‘œ ì—†ìŒ ë˜ëŠ” ì˜ëª»ë¨:', partner.name, '(lat:', partner.lat, ', lng:', partner.lng, ')');
          return;
        }
        
        var position = new naver.maps.LatLng(partner.lat, partner.lng);
        bounds.extend(position);
        
        // ë§ˆì»¤ ìƒì„±
        var marker = new naver.maps.Marker({
          position: position,
          map: map,
          title: partner.name,
          icon: {
            content: '<div style="background-color: #7B8E7E; color: white; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.2); white-space: nowrap; cursor: pointer; border: 2px solid white;">ğŸ“ ' + partner.name + '</div>',
            anchor: new naver.maps.Point(0, 0)
          }
        });
        
        // InfoWindow HTML ìƒì„±
        var infoContent = createInfoWindowHTML(partner);
        
        var infowindow = new naver.maps.InfoWindow({
          content: infoContent,
          backgroundColor: 'transparent',
          borderWidth: 0,
          disableAnchor: true,
          pixelOffset: new naver.maps.Point(0, -10),
          maxWidth: 320
        });
        
        // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
        naver.maps.Event.addListener(marker, 'click', function() {
          // ë‹¤ë¥¸ InfoWindow ë‹«ê¸°
          infowindows.forEach(function(iw) { 
            iw.close(); 
          });
          
          // í˜„ì¬ InfoWindow ì—´ê¸°
          infowindow.open(map, marker);
          currentInfoWindow = infowindow; // í˜„ì¬ InfoWindow ì¶”ì 
          map.panTo(position);
        });
        
        markers.push({ 
          marker: marker, 
          partner: partner, 
          infowindow: infowindow 
        });
        
        infowindows.push(infowindow);
        createdCount++;
      });
      
      // ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ì§€ë„ ë²”ìœ„ ì¡°ì •
      if (createdCount > 0) {
        map.fitBounds(bounds, { padding: 50 });
      }
      
      debugLog('ë§ˆì»¤ ìƒì„± ì™„ë£Œ:', createdCount + 'ê°œ');
    }
    
    // ========================================
    // InfoWindow HTML ìƒì„±
    // ========================================
    function createInfoWindowHTML(partner) {
      // ì´ë¯¸ì§€ URL ë³€í™˜
      var imageUrl = convertGoogleDriveUrl(partner.imageUrl);
      
      // ì´ë¯¸ì§€ HTML
      var imageHTML = '';
      if (imageUrl) {
        imageHTML = '<div class="info-image-container">' +
                    '<img src="' + escapeHtml(imageUrl) + '" ' +
                    'alt="' + escapeHtml(partner.name) + '" ' +
                    'class="info-image" ' +
                    'onerror="this.parentElement.innerHTML=\'<div class=\\\'info-image-placeholder\\\'>ğŸ¢</div>\'">' +
                    '</div>';
      } else {
        imageHTML = '<div class="info-image-container">' +
                    '<div class="info-image-placeholder">ğŸ¢</div>' +
                    '</div>';
      }
      
      // ì „ì²´ ì£¼ì†Œ (ë„ë¡œëª… ì£¼ì†Œ + ìƒì„¸ ì£¼ì†Œ)
      var fullAddress = partner.address;
      if (partner.detailAddress && partner.detailAddress.trim() !== '') {
        fullAddress += ' ' + partner.detailAddress;
      }
      
      // ìš´ì˜ì‹œê°„ í‘œì‹œ
      var hoursHTML = '';
      if (partner.hours && partner.hours.trim() !== '') {
        hoursHTML = '<div class="info-detail-item">' +
                    '<span class="info-detail-icon">ğŸ•</span>' +
                    '<span class="info-detail-text">' + escapeHtml(partner.hours) + '</span>' +
                    '</div>';
      }
      
      // ì „í™”ë²ˆí˜¸ ë²„íŠ¼
      var phoneButtonHTML = '';
      if (partner.phone && partner.phone.trim() !== '') {
        var phoneDisplay = partner.phone.trim();
        var phoneLink = phoneDisplay.replace(/[^0-9]/g, '');
        phoneButtonHTML = '<a href="tel:' + escapeHtml(phoneLink) + '" class="info-btn secondary">ğŸ“ ' + escapeHtml(phoneDisplay) + '</a>';
      }
      
      // ë§í¬ ë²„íŠ¼ (ë“œë¡­ë‹¤ìš´ ë°©ì‹)
      var linkButtonsHTML = '';
      if (partner.link && partner.link.trim() !== '') {
        var links = splitData(partner.link);
        
        if (links.length === 1) {
          // ë§í¬ê°€ í•˜ë‚˜ë©´ ë°”ë¡œ ë²„íŠ¼
          var linkText = 'ğŸ”— ë°©ë¬¸';
          if (links[0].includes('instagram')) linkText = 'ğŸ“· ì¸ìŠ¤íƒ€ê·¸ë¨';
          else if (links[0].includes('facebook')) linkText = 'ğŸ“˜ í˜ì´ìŠ¤ë¶';
          else if (links[0].includes('blog')) linkText = 'ğŸ“ ë¸”ë¡œê·¸';
          else if (links[0].includes('youtube')) linkText = 'â–¶ï¸ ìœ íŠœë¸Œ';
          
          linkButtonsHTML = '<a href="' + escapeHtml(links[0]) + '" target="_blank" class="info-btn">' + linkText + '</a>';
        } else if (links.length > 1) {
          // ì—¬ëŸ¬ ë§í¬ëŠ” ë“œë¡­ë‹¤ìš´
          linkButtonsHTML = '<div class="info-links-dropdown">' +
            '<button class="info-links-toggle" onclick="toggleLinksMenu(event)">ğŸ”— ë§í¬ ë³´ê¸° (' + links.length + ') â–¼</button>' +
            '<div class="info-links-menu">';
          
          links.forEach(function(link) {
            var icon = 'ğŸ”—';
            var text = 'ì›¹ì‚¬ì´íŠ¸';
            if (link.includes('instagram')) { icon = 'ğŸ“·'; text = 'ì¸ìŠ¤íƒ€ê·¸ë¨'; }
            else if (link.includes('facebook')) { icon = 'ğŸ“˜'; text = 'í˜ì´ìŠ¤ë¶'; }
            else if (link.includes('blog')) { icon = 'ğŸ“'; text = 'ë¸”ë¡œê·¸'; }
            else if (link.includes('youtube')) { icon = 'â–¶ï¸'; text = 'ìœ íŠœë¸Œ'; }
            
            linkButtonsHTML += '<a href="' + escapeHtml(link) + '" target="_blank">' + icon + ' ' + text + '</a>';
          });
          
          linkButtonsHTML += '</div></div>';
        }
      }
      
      // ê¸¸ì°¾ê¸° ë²„íŠ¼
      var navigationHTML = '';
      if (partner.lat && partner.lng) {
        var naverMapUrl = 'https://map.naver.com/v5/directions/-/-/-/car?c=' + partner.lng + ',' + partner.lat + ',15,0,0,0,dh';
        var kakaoMapUrl = 'https://map.kakao.com/link/to/' + encodeURIComponent(partner.name) + ',' + partner.lat + ',' + partner.lng;
        
        navigationHTML = '<button class="info-btn" onclick="showNavigationOptions(\'' + 
          escapeHtml(naverMapUrl) + '\', \'' + escapeHtml(kakaoMapUrl) + '\', event)">ğŸš— ê¸¸ì°¾ê¸°</button>';
      }
      
      // ìƒì„¸ë³´ê¸° ë²„íŠ¼
      var detailButtonHTML = '<button class="info-btn secondary" onclick="showDetailModal(\'' + 
        escapeHtml(JSON.stringify(partner).replace(/'/g, "\\'")) + '\', event)">ğŸ“„ ìƒì„¸ë³´ê¸°</button>';
      
      var html = '<div class="custom-infowindow">' +
                  '<button class="info-close-btn" onclick="closeInfoWindow()" title="ë‹«ê¸°">Ã—</button>' +
                  imageHTML +
                  '<div class="info-content">' +
                  '<div class="info-header">' +
                  '<h3 class="info-name">' + escapeHtml(partner.name) + '</h3>' +
                  '<span class="info-badge">' + escapeHtml(partner.category || 'ì œíœ´ì—…ì²´') + '</span>' +
                  '</div>';
      
      // í•œ ì¤„ ì†Œê°œ
      if (partner.description && partner.description.trim() !== '') {
        html += '<p class="info-description">' + escapeHtml(partner.description) + '</p>';
      }
      
      html += '<div class="info-details">' +
              '<div class="info-detail-item">' +
              '<span class="info-detail-icon">ğŸ“</span>' +
              '<span class="info-detail-text">' + escapeHtml(fullAddress) + '</span>' +
              '</div>' +
              hoursHTML +
              '</div>' +
              '<div class="info-actions">' +
              phoneButtonHTML +
              navigationHTML +
              linkButtonsHTML +
              detailButtonHTML +
              '</div>' +
              '</div>' +
              '</div>';
      
      return html;
    }
    
    // ë§í¬ ë©”ë‰´ í† ê¸€
    window.toggleLinksMenu = function(event) {
      event.stopPropagation();
      var menu = event.target.nextElementSibling;
      if (menu) {
        menu.classList.toggle('show');
      }
    };
    
    // ê¸¸ì°¾ê¸° ì˜µì…˜ í‘œì‹œ
    window.showNavigationOptions = function(naverUrl, kakaoUrl, event) {
      event.stopPropagation();
      if (confirm('ì–´ëŠ ì§€ë„ ì•±ìœ¼ë¡œ ê¸¸ì°¾ê¸°ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n[í™•ì¸] = ë„¤ì´ë²„ ì§€ë„\n[ì·¨ì†Œ] = ì¹´ì¹´ì˜¤ë§µ')) {
        window.open(naverUrl, '_blank');
      } else {
        window.open(kakaoUrl, '_blank');
      }
    };
    
    // ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ
    window.showDetailModal = function(partnerJson, event) {
      if (event) event.stopPropagation();
      
      try {
        var partner = JSON.parse(partnerJson);
        var modal = document.getElementById('detail-modal');
        var title = document.getElementById('modal-title');
        var body = document.getElementById('modal-body');
        
        if (!modal || !title || !body) return;
        
        title.textContent = partner.name;
        
        var imageUrl = convertGoogleDriveUrl(partner.imageUrl);
        var imageHTML = imageUrl ? 
          '<img src="' + escapeHtml(imageUrl) + '" class="detail-modal-image" alt="' + escapeHtml(partner.name) + '">' : '';
        
        var fullAddress = partner.address;
        if (partner.detailAddress) fullAddress += ' ' + partner.detailAddress;
        
        var categories = splitData(partner.category).join(', ') || 'ê³µë°©';
        var associations = splitData(partner.association).join(', ') || '-';
        
        body.innerHTML = imageHTML +
          '<div class="detail-modal-section">' +
          '<div class="detail-modal-section-title">ğŸ“‹ ê¸°ë³¸ ì •ë³´</div>' +
          '<p><strong>ì¹´í…Œê³ ë¦¬:</strong> ' + escapeHtml(categories) + '</p>' +
          '<p><strong>í˜‘íšŒ:</strong> ' + escapeHtml(associations) + '</p>' +
          '</div>' +
          '<div class="detail-modal-section">' +
          '<div class="detail-modal-section-title">ğŸ“ ì†Œê°œ</div>' +
          '<p>' + escapeHtml(partner.description || 'ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤.') + '</p>' +
          '</div>' +
          '<div class="detail-modal-section">' +
          '<div class="detail-modal-section-title">ğŸ“ ìœ„ì¹˜ ë° ì—°ë½ì²˜</div>' +
          '<p><strong>ì£¼ì†Œ:</strong> ' + escapeHtml(fullAddress) + '</p>' +
          '<p><strong>ì „í™”:</strong> ' + escapeHtml(partner.phone || '-') + '</p>' +
          '<p><strong>ìš´ì˜ì‹œê°„:</strong> ' + escapeHtml(partner.hours || '-') + '</p>' +
          '</div>' +
          '<div class="detail-modal-actions">' +
          '<a href="tel:' + escapeHtml(partner.phone) + '" class="detail-modal-btn primary">ğŸ“ ì „í™”í•˜ê¸°</a>' +
          '<button class="detail-modal-btn" onclick="showNavigationOptions(\'' +
          'https://map.naver.com/v5/directions/-/-/-/car?c=' + partner.lng + ',' + partner.lat + ',15,0,0,0,dh' + '\', \'' +
          'https://map.kakao.com/link/to/' + encodeURIComponent(partner.name) + ',' + partner.lat + ',' + partner.lng + '\', event)">ğŸš— ê¸¸ì°¾ê¸°</button>' +
          '<button class="detail-modal-btn" onclick="toggleFavoriteFromModal(\'' + escapeHtml(partner.name) + '\')">' +
          (isFavorite(partner.name) ? 'â­ ì°œ í•´ì œ' : 'â­ ì°œí•˜ê¸°') + '</button>' +
          '<button class="detail-modal-btn" onclick="sharePartner(\'' + escapeHtml(partner.name) + '\')">ğŸ”— ê³µìœ </button>' +
          '</div>';
        
        modal.classList.add('show');
      } catch (e) {
        console.error('ëª¨ë‹¬ í‘œì‹œ ì˜¤ë¥˜:', e);
      }
    };
    
    // ëª¨ë‹¬ì—ì„œ ì¦ê²¨ì°¾ê¸° í† ê¸€
    window.toggleFavoriteFromModal = function(name) {
      toggleFavorite(name);
      showDetailModal(JSON.stringify(partnersData.find(function(p) { return p.name === name; })));
    };
    
    // ì—…ì²´ ê³µìœ 
    window.sharePartner = function(name) {
      var url = window.location.origin + window.location.pathname + '?search=' + encodeURIComponent(name);
      if (navigator.share) {
        navigator.share({
          title: name + ' - ì œíœ´ì—…ì²´',
          url: url
        });
      } else {
        navigator.clipboard.writeText(url).then(function() {
          alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n' + url);
        });
      }
    };
    
    // ========================================
    // HTML ì´ìŠ¤ì¼€ì´í”„
    // ========================================
    function escapeHtml(text) {
      if (!text) return '';
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ========================================
    // ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜ (ëŒ€ê¸° ê°€ëŠ¥)
    // ========================================
    function tryInitMap() {
      if (typeof naver !== 'undefined' && naver.maps) {
        initMap();
        return true;
      }
      return false;
    }
    
    // ========================================
    // ì´ˆê¸°í™”
    // ========================================
    function initializeApp() {
        debugLog('DOM ë¡œë“œ ì™„ë£Œ');
        
      // ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ëŒ€ê¸° (ìµœëŒ€ 10ì´ˆ)
      var checkCount = 0;
      var maxChecks = 50; // 10ì´ˆ (200ms * 50)
      
      function checkNaverMap() {
        checkCount++;
        
        if (tryInitMap()) {
          debugLog('ì§€ë„ ì´ˆê¸°í™” ì„±ê³µ');
          loadPartnersData();
        } else if (window.naverMapLoadError) {
          // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨
          console.error('âš ï¸ ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
          document.getElementById('map-loading').innerHTML = 
            '<div style="color: #C17B7B;">' +
            '<div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>' +
            '<div>ë„¤ì´ë²„ ì§€ë„ API ë¡œë”© ì‹¤íŒ¨</div>' +
            '<div style="font-size:12px; margin-top:8px;">ë„¤ì´ë²„ í´ë¼ìš°ë“œ ì½˜ì†”ì—ì„œ Web Service URL ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”</div>' +
            '</div>';
          loadPartnersData(); // ë°ì´í„°ëŠ” ë¡œë“œ ì‹œë„
        } else if (checkCount < maxChecks) {
          // ì•„ì§ ë¡œë“œ ì¤‘, ê³„ì† ëŒ€ê¸°
          setTimeout(checkNaverMap, 200);
        } else {
          // íƒ€ì„ì•„ì›ƒ
          console.warn('âš ï¸ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ íƒ€ì„ì•„ì›ƒ');
          document.getElementById('map-loading').innerHTML = 
            '<div style="color: #C17B7B;">' +
            '<div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>' +
            '<div>ë„¤ì´ë²„ ì§€ë„ API ë¡œë”© íƒ€ì„ì•„ì›ƒ</div>' +
            '<div style="font-size:12px; margin-top:8px;">ë„¤ì´ë²„ í´ë¼ìš°ë“œ ì½˜ì†”ì—ì„œ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”</div>' +
            '</div>';
          loadPartnersData(); // ë°ì´í„°ëŠ” ë¡œë“œ ì‹œë„
        }
      }
      
      // ì§€ë„ API ë¡œë“œ í™•ì¸ ì‹œì‘
      checkNaverMap();
      
      // ========================================
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      // ========================================
      
      // ê²€ìƒ‰ ì…ë ¥
      var searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', function(e) {
          searchQuery = e.target.value;
          applyFilters();
        });
      }
      
      // ê·¼ì²˜ ë²„íŠ¼
      var btnMyLocation = document.getElementById('btn-my-location');
      if (btnMyLocation) {
        btnMyLocation.addEventListener('click', function() {
          if (this.classList.contains('active')) {
            // ë¹„í™œì„±í™”
            this.classList.remove('active');
            userLocation = null;
            sortBy = 'name';
            applyFilters();
          } else {
            // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
            if (navigator.geolocation) {
              this.textContent = 'ğŸ“ ìœ„ì¹˜ í™•ì¸ì¤‘...';
              this.disabled = true;
              
              navigator.geolocation.getCurrentPosition(
                function(position) {
                  userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                  };
                  sortBy = 'distance';
                  btnMyLocation.textContent = 'ğŸ“ ê·¼ì²˜';
                  btnMyLocation.disabled = false;
                  btnMyLocation.classList.add('active');
                  
                  // ì •ë ¬ ë“œë¡­ë‹¤ìš´ë„ ë³€ê²½
                  var sortSelect = document.getElementById('sort-select');
                  if (sortSelect) sortSelect.value = 'distance';
                  
                  applyFilters();
                },
                function(error) {
                  btnMyLocation.textContent = 'ğŸ“ ê·¼ì²˜';
                  btnMyLocation.disabled = false;
                  alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì„¤ì •ì—ì„œ ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                }
              );
            } else {
              alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
          }
        });
      }
      
      // ì°œ ë²„íŠ¼
      var btnFavorites = document.getElementById('btn-favorites');
      if (btnFavorites) {
        btnFavorites.addEventListener('click', function() {
          this.classList.toggle('active');
          applyFilters();
        });
      }
      
      // ì •ë ¬ ë“œë¡­ë‹¤ìš´
      var sortSelect = document.getElementById('sort-select');
      if (sortSelect) {
        sortSelect.addEventListener('change', function(e) {
          sortBy = e.target.value;
          applyFilters();
        });
      }
      
      // ì§€ë„ ìŠ¤íƒ€ì¼ ë²„íŠ¼
      var btnMapStyle = document.getElementById('btn-map-style');
      if (btnMapStyle) {
        btnMapStyle.addEventListener('click', function() {
          if (map) {
            if (mapStyle === 'normal') {
              map.setMapTypeId(naver.maps.MapTypeId.HYBRID);
              mapStyle = 'satellite';
              this.textContent = 'ğŸ›°ï¸';
              this.classList.add('active');
            } else {
              map.setMapTypeId(naver.maps.MapTypeId.NORMAL);
              mapStyle = 'normal';
              this.textContent = 'ğŸ—ºï¸';
              this.classList.remove('active');
            }
          }
        });
      }
      
      // ëª¨ë‹¬ ë‹«ê¸°
      var modalClose = document.getElementById('modal-close');
      if (modalClose) {
        modalClose.addEventListener('click', function() {
          document.getElementById('detail-modal').classList.remove('show');
        });
      }
      
      // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      var detailModal = document.getElementById('detail-modal');
      if (detailModal) {
        detailModal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('show');
          }
        });
      }
      
      // ========================================
      // ì´ˆê¸° ì„¤ì •
      // ========================================
      
      // ì¦ê²¨ì°¾ê¸° ë¡œë“œ
      loadFavorites();
      
      // URL íŒŒë¼ë¯¸í„° ë³µì›
      var urlParams = getUrlParams();
      if (urlParams.region && urlParams.region !== 'all') {
        currentFilters.region = urlParams.region;
      }
      if (urlParams.category && urlParams.category !== 'all') {
        currentFilters.category = urlParams.category;
      }
      if (urlParams.association && urlParams.association !== 'all') {
        currentFilters.association = urlParams.association;
      }
      if (urlParams.search) {
        searchQuery = urlParams.search;
        if (searchInput) searchInput.value = searchQuery;
      }
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
  
  <!-- ìƒì„¸ ëª¨ë‹¬ -->
  <div id="detail-modal">
    <div class="detail-modal-content">
      <div class="detail-modal-header">
        <h2 id="modal-title">ì—…ì²´ëª…</h2>
        <button class="detail-modal-close" id="modal-close">Ã—</button>
      </div>
      <div class="detail-modal-body" id="modal-body">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
      </div>
    </div>
  </div>
  
</body>
</html>

